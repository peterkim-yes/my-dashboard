<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Dashboard</title>
    <!-- Bootstrap 및 폰트 로드 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-color: #121212;
            --card-background: #1e1e1e;
            --text-color: #e0e0e0;
            --secondary-text: #999999;
            --border-color: #333333;
            --accent-color: #4CAF50;
        }
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            padding-bottom: 50px;
        }
        .container {
            max-width: 1400px;
        }
        .card {
            background-color: var(--card-background);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, .3);
            height: 100%;
        }
        h1, h2, h3 {
            color: var(--text-color);
            font-weight: 600;
        }
        iframe {
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color) !important;
        }
        .todo-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            transition: background-color .3s;
        }
        .todo-item:last-child {
            border-bottom: none;
        }
        .todo-item.completed {
            text-decoration: line-through;
            color: var(--secondary-text);
        }
        .delete-btn {
            background: none;
            border: none;
            color: #ff5252;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0 5px;
            opacity: .7;
            transition: opacity .2s;
        }
        .delete-btn:hover {
            opacity: 1;
        }
        .task-checkbox {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .task-content {
            flex-grow: 1;
            cursor: pointer;
        }
        .form-control {
            background-color: #333;
            border: 1px solid #555;
            color: #fff;
        }
        .form-control:focus {
            background-color: #333;
            color: #fff;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 .25rem rgba(76, 175, 80, 0.25);
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <header class="text-center mb-5">
            <h1 class="display-4">My Personal Dashboard</h1>
        </header>
        <div class="row">
            <div class="col-md-8 d-flex flex-column">
                <div class="row flex-grow-1">
                    <div class="col-md-12 d-flex">
                        <section id="schedule" class="card p-3 mb-4 flex-grow-1">
                            <h2>Today's Schedule</h2>
                            <!-- 구글 캘린더 임베드 -->
                            <iframe src="https://calendar.google.com/calendar/embed?src=sunkyu0702%40gmail.com&ctz=Asia%2FSeoul" style="border:0" width="100%" height="550" frameborder="0" scrolling="no"></iframe>
                        </section>
                    </div>
                </div>
                <section id="design" class="card p-3 mb-4">
                    <h2>Design Inspiration (Notion Embed)</h2>
                    <!-- 노션 임베드 -->
                    <iframe src="https://cut-midnight-8d0.notion.site/ebd/f9c038827137408c883593fef6914b44" width="100%" height="550" frameborder="0" allowfullscreen></iframe>
                </section>
            </div>
            <div class="col-md-4 d-flex flex-column">
                <section id="economy" class="card p-3 mb-4">
                    <h2>Key Market Indicators (Including Crypto)</h2>
                    <!-- TradingView 시장 개요 위젯 -->
                    <div class="tradingview-widget-container">
                        <div class="tradingview-widget-container__widget"></div>
                        <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/markets/" rel="noopener nofollow" target="_blank"><span class="blue-text">World markets</span></a><span class="trademark"> by TradingView</span></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                            {
                                "colorTheme":"dark", "dateRange":"12M", "locale":"en", "largeChartUrl":"",
                                "isTransparent":false, "showFloatingTooltip":false, "plotLineColorGrowing":"rgba(76, 175, 80, 1)", 
                                "plotLineColorFalling":"rgba(76, 175, 80, 1)", "gridLineColor":"rgba(240, 243, 250, 0)",
                                "scaleFontColor":"#DBDBDB", "belowLineFillColorGrowing":"rgba(76, 175, 80, 0.12)", 
                                "belowLineFillColorFalling":"rgba(76, 175, 80, 0.12)", "belowLineFillColorGrowingBottom":"rgba(76, 175, 80, 0)", 
                                "belowLineFillColorFallingBottom":"rgba(76, 175, 80, 0)", "symbolActiveColor":"rgba(76, 175, 80, 0.12)", 
                                "tabs":[
                                    { "title":"Index", "symbols":[ { "s":"NASDAQ:NDAQ", "d":"NASDAQ" }, { "s":"KRX:KOSPI", "d":"KOSPI" } ], "originalTitle":"Index" },
                                    {
                                        "title":"Crypto",
                                        "symbols":[
                                            { "s":"BINANCE:BTCUSDT", "d":"BTC/USDT", "base-currency-logoid":"crypto/XTVCBTC", "currency-logoid":"crypto/XTVCUSDT" },
                                            { "s":"BINANCE:ETHUSDT", "d":"ETH/USDT", "base-currency-logoid":"crypto/XTVCETH", "currency-logoid":"crypto/XTVCUSDT" }
                                        ],
                                        "originalTitle":"Crypto"
                                    },
                                    { "title":"Futures", "symbols":[ { "s":"BMFBOVESPA:ISP1!", "d":"S&P 500" }, { "s":"CMCMARKETS:GOLD", "d":"Gold" }, { "s":"PYTH:WTI3!", "d":"WTI Crude Oil" } ], "originalTitle":"Futures" },
                                    { "title":"Forex", "symbols":[ { "s":"FX:EURUSD", "d":"EUR to USD" }, { "s":"FX:USDJPY", "d":"USD to JPY" } ] }
                                ],
                                "support_host":"https://www.tradingview.com", "backgroundColor":"#0f0f0f",
                                "width":"100%", "height":"550", "showSymbolLogo":true, "showChart":true
                            }
                        </script>
                    </div>
                </section>
                <section id="extra" class="card p-3 mb-4 flex-grow-1">
                    <h2>My To-Do List</h2>
                    <p id="storageStatus" style="font-size:.8rem;color:#03A9F4;margin-bottom:5px;">로컬 저장소 사용 중 (데이터는 이 브라우저에만 저장됩니다)</p>
                    <!-- 할 일 입력 섹션 -->
                    <div class="input-group mb-3">
                        <input type="text" id="todoInput" class="form-control" placeholder="새로운 할 일 입력" aria-label="New todo item">
                        <button class="btn btn-success" type="button" id="addTodoBtn" style="background-color:var(--accent-color);border-color:var(--accent-color);">추가</button>
                    </div>
                    <!-- 할 일 목록 표시 섹션 -->
                    <div id="todoList" class="list-group list-group-flush" style="max-height:400px;overflow-y:auto;">
                        <!-- To-Do 항목들이 여기에 렌더링됩니다 -->
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- 로컬 스토리지 기반 To-Do List 로직 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
        // 로컬 스토리지 키 정의
        const STORAGE_KEY = 'myDashboardTodos';
        const todoListElement = document.getElementById('todoList');
        const todoInput = document.getElementById('todoInput');
        const addTodoBtn = document.getElementById('addTodoBtn');

        // 로컬 스토리지에서 To-Do 목록을 로드합니다.
        function loadTodos() {
            try {
                // 저장된 JSON 문자열을 배열로 파싱합니다.
                const todos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                return Array.isArray(todos) ? todos : [];
            } catch (e) {
                console.error("로컬 저장소에서 할 일 목록을 불러오는 데 실패했습니다:", e);
                return [];
            }
        }

        // 로컬 스토리지에 To-Do 목록을 저장하고 렌더링을 트리거합니다.
        function saveAndRenderTodos(todos) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
            renderTodos(todos);
        }

        // To-Do 목록 렌더링
        function renderTodos(todos) {
            todoListElement.innerHTML = '';
            
            if (todos.length === 0) {
                todoListElement.innerHTML = '<p class="text-center p-3" style="color:var(--secondary-text);">아직 할 일이 없습니다. 새 할 일을 추가해보세요!</p>';
                return;
            }

            // 최신 항목이 위로 오도록 정렬 (timestamp 기준)
            todos.sort((a, b) => b.timestamp - a.timestamp);

            todos.forEach(todo => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                itemDiv.setAttribute('data-id', todo.id);
                itemDiv.innerHTML = `
                    <input type="checkbox" class="task-checkbox" ${todo.completed ? 'checked' : ''} data-action="toggle">
                    <span class="task-content" data-action="toggle">${todo.text}</span>
                    <button class="delete-btn" data-action="delete">&times;</button>
                `;
                // 이벤트 리스너를 추가하여 ID를 전달합니다.
                itemDiv.addEventListener('click', (e) => handleTodoAction(e, todo.id));
                todoListElement.appendChild(itemDiv);
            });
        }

        // 새 To-Do 항목 추가
        function addTodo() {
            const text = todoInput.value.trim();

            if (!text) return;

            const newTodo = {
                id: Date.now(), // 고유 ID로 현재 타임스탬프 사용
                text: text,
                completed: false,
                timestamp: Date.now()
            };

            const todos = loadTodos();
            todos.push(newTodo);
            saveAndRenderTodos(todos);
            
            todoInput.value = ''; // 입력 필드 초기화
        }

        // To-Do 항목 클릭 이벤트 처리 (완료 상태 토글 또는 삭제)
        function handleTodoAction(e, id) {
            // 클릭된 요소의 'data-action' 속성 또는 클래스를 확인합니다.
            const action = e.target.getAttribute('data-action');
            const isCheckbox = e.target.classList.contains('task-checkbox');

            let todos = loadTodos();

            if (action === 'toggle' || isCheckbox) {
                // 완료 상태 토글
                todos = todos.map(todo => 
                    todo.id === id ? { ...todo, completed: !todo.completed } : todo
                );
            } else if (action === 'delete') {
                // 삭제
                todos = todos.filter(todo => todo.id !== id);
            }
            
            saveAndRenderTodos(todos);
        }

        // 초기 로드 및 이벤트 리스너 설정
        document.addEventListener('DOMContentLoaded', () => {
            // 초기 To-Do 목록 로드 및 렌더링
            saveAndRenderTodos(loadTodos());

            addTodoBtn.addEventListener('click', addTodo);
            
            // Enter 키 입력 처리
            todoInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Enter 키로 폼이 제출되는 것을 방지
                    addTodo(); 
                }
            });
        });
    </script>
</body>
</html>